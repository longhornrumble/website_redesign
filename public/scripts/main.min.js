const SCROLL_THRESHOLD=50,SWIPE_THRESHOLD=50,ANIMATION_DURATION=1500,FADE_IN_THRESHOLD=.1,SETUP_ANIMATION_THRESHOLD=.2;document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("header"),t=document.getElementById("logo-default"),n=document.getElementById("logo-scrolled");function a(){window.scrollY>50?(e?.classList.add("scrolled"),t?.classList.add("hidden"),n?.classList.remove("hidden")):(e?.classList.remove("scrolled"),t?.classList.remove("hidden"),n?.classList.add("hidden"))}window.addEventListener("scroll",a),a();const s=document.getElementById("mobile-menu-btn"),o=document.getElementById("mobile-menu"),d=document.querySelectorAll(".mobile-nav-link");function l(){s?.classList.remove("open"),o?.classList.remove("open"),s?.setAttribute("aria-expanded","false"),s?.focus()}s&&o&&(s.setAttribute("aria-expanded","false"),s.setAttribute("aria-controls","mobile-menu"),s.addEventListener("click",()=>{s.classList.contains("open")?l():function(){s?.classList.add("open"),o?.classList.add("open"),s?.setAttribute("aria-expanded","true");const e=o?.querySelector("a");e?.focus()}()}),d.forEach(e=>{e.addEventListener("click",l)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&s.classList.contains("open")&&l()}),o.addEventListener("keydown",e=>{if("Tab"!==e.key)return;const t=o.querySelectorAll("a[href], button:not([disabled])"),n=t[0],a=t[t.length-1];e.shiftKey&&document.activeElement===n?(e.preventDefault(),a?.focus()):e.shiftKey||document.activeElement!==a||(e.preventDefault(),n?.focus())}));document.querySelectorAll(".faq-btn").forEach(e=>{e.addEventListener("click",()=>{if(window.innerWidth<768){const t=e.closest(".faq-item");t?.classList.toggle("open")}})});const i=document.getElementById("billing-monthly"),c=document.getElementById("billing-annual"),r=document.getElementById("standard-price"),u=document.getElementById("premium-price"),m=document.getElementById("standard-billing-note"),h=document.getElementById("premium-billing-note"),g=document.getElementById("standard-cta"),y=document.getElementById("premium-cta-save"),E=document.getElementById("billing-message");function v(e){i?.setAttribute("aria-checked",(!e).toString()),c?.setAttribute("aria-checked",e.toString()),e?(r&&(r.textContent="120"),u&&(u.textContent="240"),m?.classList.remove("hidden"),h?.classList.remove("hidden"),g&&(g.textContent="Get Started â€” Save 20%"),y?.classList.remove("hidden"),E&&(E.textContent="Billed annually. Switch to monthly anytime."),c?.classList.add("bg-emerald-500","text-white"),c?.classList.remove("text-slate-600","hover:text-slate-900"),i?.classList.remove("bg-emerald-500","text-white"),i?.classList.add("text-slate-600","hover:text-slate-900")):(r&&(r.textContent="150"),u&&(u.textContent="300"),m?.classList.add("hidden"),h?.classList.add("hidden"),g&&(g.textContent="Get Started"),y?.classList.add("hidden"),E&&(E.textContent="Billed monthly. Switch to annual anytime."),i?.classList.add("bg-emerald-500","text-white"),i?.classList.remove("text-slate-600","hover:text-slate-900"),c?.classList.remove("bg-emerald-500","text-white"),c?.classList.add("text-slate-600","hover:text-slate-900"))}i&&c&&(i.setAttribute("role","radio"),i.setAttribute("aria-checked","true"),c.setAttribute("role","radio"),c.setAttribute("aria-checked","false"),i.addEventListener("click",()=>v(!1)),c.addEventListener("click",()=>v(!0)),[i,c].forEach(e=>{e.addEventListener("keydown",e=>{if("ArrowLeft"===e.key||"ArrowRight"===e.key){e.preventDefault();document.activeElement===i?(c.focus(),v(!0)):(i.focus(),v(!1))}})}));const L=document.querySelectorAll(".checkout-btn"),b=document.getElementById("checkout-modal"),f=document.getElementById("checkout-modal-backdrop"),w=document.getElementById("checkout-modal-close"),p=document.getElementById("checkout-form"),k=document.getElementById("checkout-plan"),x=document.querySelectorAll('input[name="taxExempt"]'),I=document.getElementById("ein-field"),A=document.getElementById("checkout-submit");let S=!1;function B(){b&&b.classList.add("hidden"),document.body.style.overflow=""}i&&c&&(i.addEventListener("click",()=>{S=!1}),c.addEventListener("click",()=>{S=!0})),L.forEach(e=>{e.addEventListener("click",()=>{const t=S?e.dataset.planAnnual:e.dataset.planMonthly;k&&(k.value=t),b&&b.classList.remove("hidden"),document.body.style.overflow="hidden",document.getElementById("checkout-name")?.focus()})}),w?.addEventListener("click",B),f?.addEventListener("click",B),document.addEventListener("keydown",e=>{"Escape"===e.key&&b&&!b.classList.contains("hidden")&&B()}),x.forEach(e=>{e.addEventListener("change",e=>{I&&("yes"===e.target.value?I.classList.remove("hidden"):I.classList.add("hidden"))})}),p?.addEventListener("submit",async e=>{e.preventDefault();const t=new FormData(p),n=t.get("plan"),a=t.get("contactName"),s=t.get("email"),o=t.get("organizationName"),d="yes"===t.get("taxExempt"),l=t.get("ein");A&&(A.disabled=!0,A.textContent="Redirecting...");try{const e=await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plan:n,contactName:a,email:s,organizationName:o,taxExempt:d,ein:l})}),t=await e.json();if(!t.url)throw new Error(t.error||"Failed to create checkout");window.location.href=t.url}catch(e){console.error("Checkout error:",e),A&&(A.disabled=!1,A.textContent="Continue to Checkout"),alert("Something went wrong. Please try again.")}});const C=document.querySelectorAll(".carousel-tab"),D=document.querySelectorAll(".carousel-slide"),q=document.querySelectorAll("[data-indicator]"),T=document.getElementById("carousel-slides"),N=D.length||3;let O=0,H=null;function R(e){O=e,C.forEach((t,n)=>{const a=n===e;t.setAttribute("aria-selected",a.toString()),t.setAttribute("tabindex",a?"0":"-1"),a?(t.classList.add("bg-emerald-500","text-white","shadow-lg","shadow-emerald-500/25"),t.classList.remove("bg-slate-800","text-slate-400","hover:bg-slate-700","hover:text-white")):(t.classList.remove("bg-emerald-500","text-white","shadow-lg","shadow-emerald-500/25"),t.classList.add("bg-slate-800","text-slate-400","hover:bg-slate-700","hover:text-white"))}),q.forEach((t,n)=>{n===e?(t.classList.add("w-8","bg-emerald-500"),t.classList.remove("w-2","bg-slate-700")):(t.classList.remove("w-8","bg-emerald-500"),t.classList.add("w-2","bg-slate-700"))}),D.forEach((t,n)=>{n===e?(t.classList.remove("hidden"),t.setAttribute("aria-hidden","false"),M(t)):(t.classList.add("hidden"),t.setAttribute("aria-hidden","true"))})}function M(e){e.querySelectorAll(".counter").forEach(e=>{const t=parseFloat(e.dataset.target),n=parseInt(e.dataset.decimals)||0;isNaN(t)||t<0?console.warn("Invalid counter target:",e.dataset.target):(e.textContent="0",function(e,t,n=1500,a=0){let s=0;const o=t/(n/16),d=setInterval(()=>{s+=o,s>=t?(e.textContent=a>0?t.toFixed(a):Math.floor(t).toLocaleString(),clearInterval(d)):e.textContent=a>0?s.toFixed(a):Math.floor(s).toLocaleString()},16)}(e,t,1500,n))})}C.forEach((e,t)=>{e.setAttribute("role","tab"),e.setAttribute("aria-selected",0===t?"true":"false"),e.setAttribute("tabindex",0===t?"0":"-1"),e.addEventListener("click",()=>R(t)),e.addEventListener("keydown",e=>{let t=O;"ArrowLeft"===e.key?(e.preventDefault(),t=(O-1+N)%N):"ArrowRight"===e.key?(e.preventDefault(),t=(O+1)%N):"Home"===e.key?(e.preventDefault(),t=0):"End"===e.key&&(e.preventDefault(),t=N-1),t!==O&&(R(t),C[t]?.focus())})}),D.forEach((e,t)=>{e.setAttribute("role","tabpanel"),e.setAttribute("aria-hidden",0===t?"false":"true")}),T&&(T.addEventListener("touchstart",e=>{H=e.touches[0].clientX}),T.addEventListener("touchend",e=>{if(!H)return;const t=e.changedTouches[0].clientX,n=H-t;Math.abs(n)>50&&(R(n>0?(O+1)%N:(O-1+N)%N),setTimeout(()=>{document.getElementById("slide-eyebrow")?.scrollIntoView({behavior:"smooth",block:"start"})},50)),H=null})),D.length>0&&M(D[0]);const _=document.querySelectorAll(".fade-in"),F=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target.style.transitionDelay||"0ms",n=parseInt(t);setTimeout(()=>{e.target.classList.add("visible")},n)}})},{threshold:.1});_.forEach(e=>F.observe(e));const P=document.getElementById("setup"),j=document.querySelectorAll(".setup-dot");if(P&&j.length>0){const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(j.forEach(e=>{const t=e.dataset.delay||"0s";e.style.animation="sequentialPulse 11s infinite",e.style.animationDelay=t}),e.unobserve(t.target))})},{threshold:.2});e.observe(P)}});